<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - Z17 MDIS Driver - Main Page</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;"></a>
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">Z17 MDIS Driver &nbsp; </h1>
	<h3>Main Page</h3>
</div>
<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Z17 MDIS Driver Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the documentation of the MDIS low-level driver for the 16Z034, 16Z037 and 16Z127 GPIO controller.</p>
<p>16Z034, 16Z037 and 16Z127 are GPIO controller implemented in the Chameleon FPGA. They support the following features:</p>
<ul>
<li>8/32 bit (Z34/Z127) general purpose I/O</li>
<li>data direction programmable for every I/O port</li>
<li>state of output port pins readable</li>
<li>ability to generate interrupts on rising, falling or both edges on port</li>
<li>every port can work in open drain mode (Arwen_2 only)</li>
<li>hardware debouncing possible for every port (Arwen_2 only)</li>
</ul>
<p>This driver supports the 16Z034, 16Z037 and 16Z127 GPIO controller. They use call locking.</p>
<p>Note: MDIS5 32bit drivers are compatible to the MDIS4 drivers, but must not be mixed with MDIS4 drivers at one target system.</p>
<p><br />
</p>
<h1><a class="anchor" id="Variants"></a>
Variants</h1>
<ul>
<li>z17 (defualt) : for 8-bit 16Z034/16Z037 GPIO controller</li>
<li>z17_io : for 8-bit 16Z034/16Z037 GPIO controller with io mapped address space</li>
<li>z17_z127 : for 32-bit 16Z127-00 GPIO controller</li>
<li>z17_z127_noirq : for 32-bit 16Z127-00 GPIO controller without interrupt support</li>
<li>z17_z127v01 : for 32-bit 16Z127-01 GPIO controller with configurable debounce time</li>
</ul>
<p><br />
 </p>
<h1><a class="anchor" id="FuncDesc"></a>
Functional Description</h1>
<p><br />
 </p>
<h2><a class="anchor" id="General"></a>
General</h2>
<p>The most functions return/take an 8 bit value. If not described differently every bit in the set/read values correspond to a single IO port pin. Bit 0 (LSB) to port 0, bit 7 (MSB) to port 7.</p>
<p><br />
 </p>
<h2><a class="anchor" id="readwrite"></a>
Reading and writing</h2>
<p>The M_read() function call reads the current state of all ports (input and output) at once. M_write() forces all ports which are programmed as outputs to the given level.</p>
<ul>
<li>Bit=0: low level on port pin</li>
<li>Bit=1: high level on port pin</li>
</ul>
<p>Additionally ports can be set/ cleared using SetStat Z17_SET_PORTS and Z17_CLEAR_PORTS. These functions affect only the ports whose corresponding bits are set in the given value.</p>
<p>Data direction can be programmed using SetStat Z17_DIRECTION.</p><ul>
<li>Bit=0: port is input</li>
<li>Bit=1: port is output</li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="interrupts"></a>
Interrupt handling and signals</h2>
<p>Using SetStat Z17_IRQ_SENSE it is possible to determine if an interrupt is generated on rising edge, falling edge, both edges or not at all. If an interrupt happens the driver will send the signal which was assigned using SetStat Z17_SET_SIGNAL to the application. Uninstall signal using Z17_CLR_SIGNAL.</p>
<p>The current status can be read back using GetStat Z17_IRQ_SENSE.</p>
<p>Z17_IRQ_SENSE takes a 16 bit value. Two bits correspond to each port: Bit1/ 0 to port 0, bit 3/2 to port 1,..., bit15/14 to port7.</p>
<p>Bit encoding:</p><ul>
<li>00 No interrupt generated for port</li>
<li>01 Interrupt generated at rising edge on port</li>
<li>10 Interrupt generated at falling edge on port</li>
<li>11 Interrupt generated at rising and falling edge on port</li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="opendrain"></a>
Open Drain feature</h2>
<p>The open drain feature of Arwen_2 can be enabled using SetStat Z17_OPEN_DRAIN. This SetStat code is applicable for Arwen_3 too, but no action is performed. If the corresponding bit is set, the output pin is only driven if its value is set to low (similar to an open collector/open drain driver). By default, all ports are driven to both high and low, if they are programmed as output. The current status can be read back using GetStat Z17_OPEN_DRAIN.</p>
<ul>
<li>Bit=0: port in normal mode</li>
<li>Bit=1: port open drain</li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="debounce"></a>
Debouncing</h2>
<p>Debouncing is enabled for Arwen_2 using SetStat Z17_DEBOUNCE. On Arwen_3 no action is performed. This enables the hardware debouncer for all ports whose corresponding bit is set. It disables the debouncer for all ports whose corresponding bit is cleared. The current status can be read back using GetStat Z17_DEBOUNCE</p>
<ul>
<li>Bit=0: debouncing off</li>
<li>Bit=1: debouncing on</li>
</ul>
<p>The 16Z127-01 IP core supports a configurable debounce time for each input port. The debounce time can be set/get with the block SetStat/ GetStat Z17_BLK_DEBOUNCE_TIME.<br />
Note: This requires the z17_z127v01 driver variant!</p>
<p><br />
 </p>
<h2><a class="anchor" id="default"></a>
Default values</h2>
<p>M_open() and M_close() set all ports to default values:</p>
<ul>
<li>Ports programmed as inputs</li>
<li>Interrupts disabled</li>
<li>Open drain and debouncing disabled</li>
</ul>
<p><br />
 </p>
<h2><a class="anchor" id="sa15"></a>
SA15 issues</h2>
<p>SA15 is an IO adapter implementing digital input/outputs. It works together with the 16Z037 GPIO controller.</p>
<p>Ports supported:</p><ul>
<li>OUT 0..4: 16Z037 port 0..4 when configured as output</li>
<li>IN 0..4: 16Z037 port 0..4, always readable</li>
<li>IO 0..3: 16Z037 port 5..7, data direction programmable</li>
</ul>
<p>The out ports on SA15 are driven by an open collector driver, push-pull operation is not possible. Setstats Z17_OPEN_DRAIN and Z17_DEBOUNCE do not work. Also it is not possible to read back the current state of OUT 0..4 since the corresponging input circuity is internally wired to IN 0..4.</p>
<p><br />
 </p>
<h1><a class="anchor" id="api_functions"></a>
Supported API Functions</h1>
<table  border="0">
<tr>
<td><b>API function</b> </td><td><b>Functionality</b> </td><td><p class="starttd"><b>Corresponding low level function</b></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>M_open() </td><td>Open device  </td><td><a class="el" href="z17__drv_8c.html#aa47456858f4feff1ce123f08245497dc" title="Allocate and return low-level handle, initialize hardware. ">Z17_Init()</a> </td></tr>
<tr>
<td>M_close() </td><td>Close device  </td><td><a class="el" href="z17__drv_8c.html#a6fd3b67f2690a64ebdb55cde827c88e3" title="De-initialize hardware and clean up memory. ">Z17_Exit()</a> </td></tr>
<tr>
<td>M_read() </td><td>Read from device  </td><td><a class="el" href="z17__drv_8c.html#accffa2bf35599ca8d55beb84927036f0" title="Read a value from the device. ">Z17_Read()</a> </td></tr>
<tr>
<td>M_write() </td><td>Write to device  </td><td><a class="el" href="z17__drv_8c.html#a4df445d09d7e7b04b03fa38a5ef9a358" title="Description: Write a value to the device. ">Z17_Write()</a> </td></tr>
<tr>
<td>M_setstat() </td><td>Set device parameter  </td><td><a class="el" href="z17__drv_8c.html#a4d2755e2b05c996a9d03ec0dbefd654a" title="Set the driver status. ">Z17_SetStat()</a> </td></tr>
<tr>
<td>M_getstat() </td><td>Get device parameter  </td><td><a class="el" href="z17__drv_8c.html#a3eb627d23bf92b080243c988a58a8c94" title="Get the driver status. ">Z17_GetStat()</a> </td></tr>
<tr>
<td>M_getblock() </td><td>Block read from device  </td><td><a class="el" href="z17__drv_8c.html#a3c909ebf901146afeff99b2ef8c72838" title="Read a data block from the device. ">Z17_BlockRead()</a> </td></tr>
<tr>
<td>M_setblock() </td><td>Block write from device  </td><td><a class="el" href="z17__drv_8c.html#a729589ea6f0de88c944b72f9e8a073eb" title="Write a data block from the device. ">Z17_BlockWrite()</a> </td></tr>
<tr>
<td>M_errstringTs() </td><td>Generate error message  </td><td>- </td></tr>
</table>
<p><br />
 </p>
<h1><a class="anchor" id="descriptor_entries"></a>
Descriptor Entries</h1>
<table  border="0">
<tr>
<td><b>Key</b> </td><td><b>Default</b> </td><td><b>Range</b> </td><td><p class="starttd"><b>Functionality</b></p>
<p class="endtd"></p>
</td></tr>
<tr>
<td>RESET_OFF</td><td>0</td><td>0..1</td><td>disables controller reset during M_close() </td></tr>
</table>
<p><br />
 </p>
<h1><a class="anchor" id="codes"></a>
Z17 specific Getstat/Setstat codes</h1>
<p>see section about Getstat/Setstat codes</p>
<p><br />
 </p>
<h1><a class="anchor" id="Documents"></a>
Overview of all Documents</h1>
<h2><a class="anchor" id="z17_simp"></a>
Simple example for using the driver</h2>
<p>z17_simp.c (see example section)</p>
<h2><a class="anchor" id="z17_io"></a>
Tool to access the 16Z034/16Z037 I/Os</h2>
<p>z17_io.c (see example section)</p>
<h2><a class="anchor" id="z127_io"></a>
Tool to access the 16Z127 I/Os</h2>
<p>z127_io.c (see example section)</p>
<h2><a class="anchor" id="z17_min"></a>
Minimum descriptor</h2>
<p>z17_min.dsc demonstrates the minimum set of options necessary for using the drver.</p>
<h2><a class="anchor" id="z17_max"></a>
Maximum descriptor</h2>
<p>z17_max.dsc shows all possible configuration options for this driver. </p>
</div></div><!-- contents -->

	</div>
</div>
<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for Z17 MDIS Driver using <a href="http://www.doxygen.org">doxygen</a>.<br>
	Copyright &copy; 2016 <a href="http://www.men.de">MEN Mikro Elektronik GmbH</a>. All Rights Reserved.
	</p>
</div>
</body>
</html>
