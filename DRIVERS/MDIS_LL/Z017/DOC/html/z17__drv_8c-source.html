<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>MEN - Z17 MDIS Driver - z17_drv.c Source File</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<meta name="Language" content="en, english">
<meta name="Copyright" content="All material copyright MEN Mikro Elektronik GmbH">
<link href="men_stylesheet.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="left_to_right" style="padding-top: 6px; background-color: #F0F0F0; height: 110px; border-bottom: 2px solid #D1D1D2;">
	<!-- Titel -->
	<img src="menlogo.gif" alt="MEN" style="float: left; height: 103px; width: 155px; margin: 0px;">
	<h1 style="margin: 0px; padding-top: 35px; padding-bottom: 0px;">Z17 MDIS Driver &nbsp; </h1>
	<h3>z17_drv.c Source File</h3>
</div>

<div class="left_to_right">
<!-- Hauptteil -->
	<div class="main">
<!-- Generated by Doxygen 1.3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; <a class="qindex" href="examples.html">Examples</a> &nbsp; </center>
<hr><h1>z17_drv.c</h1><a href="z17__drv_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*********************  P r o g r a m  -  M o d u l e ***********************/</span>
00018  <span class="comment">/*</span>
00019 <span class="comment"> *---------------------------------------------------------------------------</span>
00020 <span class="comment"> * Copyright (c) 2004-2019, MEN Mikro Elektronik GmbH</span>
00021 <span class="comment"> ****************************************************************************/</span>
00022  <span class="comment">/*</span>
00023 <span class="comment"> * This program is free software: you can redistribute it and/or modify</span>
00024 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
00025 <span class="comment"> * the Free Software Foundation, either version 2 of the License, or</span>
00026 <span class="comment"> * (at your option) any later version.</span>
00027 <span class="comment"> *</span>
00028 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
00029 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00030 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00031 <span class="comment"> * GNU General Public License for more details.</span>
00032 <span class="comment"> *</span>
00033 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
00034 <span class="comment"> * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
00035 <span class="comment"> */</span>
00036 
<a name="l00037"></a><a class="code" href="z17__drv_8c.html#a0">00037</a> <span class="preprocessor">#define _NO_LL_HANDLE        </span><span class="comment">/* ll_defs.h: don't define LL_HANDLE struct */</span>
00038 
00039 <span class="comment">/*-----------------------------------------+</span>
00040 <span class="comment">|  INCLUDES                                |</span>
00041 <span class="comment">+-----------------------------------------*/</span>
00042 <span class="preprocessor">#include &lt;MEN/men_typs.h&gt;</span>    <span class="comment">/* system dependent definitions   */</span>
00043 <span class="preprocessor">#include &lt;MEN/maccess.h&gt;</span>     <span class="comment">/* hw access macros and types     */</span>
00044 <span class="preprocessor">#include &lt;MEN/dbg.h&gt;</span>         <span class="comment">/* debug functions                */</span>
00045 <span class="preprocessor">#include &lt;MEN/oss.h&gt;</span>         <span class="comment">/* oss functions                  */</span>
00046 <span class="preprocessor">#include &lt;MEN/desc.h&gt;</span>        <span class="comment">/* descriptor functions           */</span>
00047 <span class="preprocessor">#include &lt;MEN/modcom.h&gt;</span>      <span class="comment">/* ID PROM functions              */</span>
00048 <span class="preprocessor">#include &lt;MEN/mdis_api.h&gt;</span>    <span class="comment">/* MDIS global defs               */</span>
00049 <span class="preprocessor">#include &lt;MEN/mdis_com.h&gt;</span>    <span class="comment">/* MDIS common defs               */</span>
00050 <span class="preprocessor">#include &lt;MEN/mdis_err.h&gt;</span>    <span class="comment">/* MDIS error codes               */</span>
00051 <span class="preprocessor">#include &lt;MEN/ll_defs.h&gt;</span>     <span class="comment">/* low-level driver definitions   */</span>
00052 <span class="preprocessor">#include &lt;MEN/arwen.h&gt;</span>       <span class="comment">/* definitions for Arwen GPIO     */</span>
00053 <span class="preprocessor">#include &lt;MEN/chameleon.h&gt;</span>   <span class="comment">/* chameleon header               */</span>
00054 
00055 <span class="comment">/*-----------------------------------------+</span>
00056 <span class="comment">|  DEFINES                                 |</span>
00057 <span class="comment">+-----------------------------------------*/</span>
00058 <span class="preprocessor">#if (defined(Z127V01) &amp;&amp; defined(MDIS_MA_BB_INFO_PTR))</span>
00059 <span class="preprocessor"></span><span class="preprocessor">    #define Z127_INFO_PTR 1</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00061 <span class="preprocessor"></span>
00062 <span class="comment">/* general defines */</span>
<a name="l00063"></a><a class="code" href="z17__drv_8c.html#a1">00063</a> <span class="preprocessor">#define CH_NUMBER          1          </span>
00064 <span class="preprocessor">#ifdef Z127_NOIRQ</span>
00065 <span class="preprocessor"></span><span class="preprocessor">  #define USE_IRQ            FALSE      </span>
00066 <span class="preprocessor">#else</span>
<a name="l00067"></a><a class="code" href="z17__drv_8c.html#a2">00067</a> <span class="preprocessor"></span><span class="preprocessor">  #define USE_IRQ            TRUE       </span>
00068 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
00069 
00070 <span class="preprocessor">#ifdef Z127_INFO_PTR</span>
00071 <span class="preprocessor"></span><span class="preprocessor">    #define ADDRSPACE_COUNT    2          </span>
00072 <span class="preprocessor">    #define ADDRSPACE_SIZE     0x100      </span>
00073 <span class="preprocessor">#else</span>
<a name="l00074"></a><a class="code" href="z17__drv_8c.html#a3">00074</a> <span class="preprocessor"></span><span class="preprocessor">    #define ADDRSPACE_COUNT    1          </span>
<a name="l00075"></a><a class="code" href="z17__drv_8c.html#a4">00075</a> <span class="preprocessor">    #define ADDRSPACE_SIZE     0x20       </span>
00076 <span class="preprocessor">#endif</span>
00077 <span class="preprocessor"></span>
00078 <span class="comment">/* debug defines */</span>
<a name="l00079"></a><a class="code" href="z17__drv_8c.html#a5">00079</a> <span class="preprocessor">#define DBG_MYLEVEL        llHdl-&gt;dbgLevel    </span>
<a name="l00080"></a><a class="code" href="z17__drv_8c.html#a6">00080</a> <span class="preprocessor">#define DBH                llHdl-&gt;dbgHdl      </span>
<a name="l00081"></a><a class="code" href="z17__drv_8c.html#a7">00081</a> <span class="preprocessor">#define OSH                llHdl-&gt;osHdl       </span>
00083 <span class="preprocessor"></span><span class="comment">/* toggle mode defines */</span>
<a name="l00084"></a><a class="code" href="z17__drv_8c.html#a8">00084</a> <span class="preprocessor">#define TOG_TIME_DEFAULT   1000       </span>
<a name="l00085"></a><a class="code" href="z17__drv_8c.html#a9">00085</a> <span class="preprocessor">#define TOG_TIME_MIN       100        </span>
<a name="l00086"></a><a class="code" href="z17__drv_8c.html#a10">00086</a> <span class="preprocessor">#define TOG_TIME_MAX       60000      </span>
<a name="l00087"></a><a class="code" href="z17__drv_8c.html#a11">00087</a> <span class="preprocessor">#define TOG_CYCLIC         1          </span>
00089 <span class="preprocessor"></span><span class="comment">/* descriptor key defines*/</span>
<a name="l00090"></a><a class="code" href="z17__drv_8c.html#a12">00090</a> <span class="preprocessor">#define RESET_DEFAULT      0          </span>
<a name="l00091"></a><a class="code" href="z17__drv_8c.html#a13">00091</a> <span class="preprocessor">#define RESET_OFF          1          </span>
00093 <span class="preprocessor"></span><span class="comment">/*-----------------------------------------+</span>
00094 <span class="comment">|  TYPEDEFS                                |</span>
00095 <span class="comment">+-----------------------------------------*/</span>
00096 
<a name="l00097"></a><a class="code" href="structLL__HANDLE.html">00097</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00098     <span class="comment">/* general */</span>
<a name="l00099"></a><a class="code" href="structLL__HANDLE.html#m0">00099</a>     int32                   memAlloc;       
<a name="l00100"></a><a class="code" href="structLL__HANDLE.html#m1">00100</a>     OSS_HANDLE              *osHdl;         
<a name="l00101"></a><a class="code" href="structLL__HANDLE.html#m2">00101</a>     OSS_IRQ_HANDLE          *irqHdl;        
<a name="l00102"></a><a class="code" href="structLL__HANDLE.html#m3">00102</a>     DESC_HANDLE             *descHdl;       
<a name="l00103"></a><a class="code" href="structLL__HANDLE.html#m4">00103</a>     MACCESS                 ma;             
00104 <span class="preprocessor">#ifdef Z127_INFO_PTR</span>
00105 <span class="preprocessor"></span>    CHAMELEONV2_UNIT        *chamu;         
00106     u_int32                 vdt;            
00107 <span class="preprocessor">#endif</span>
<a name="l00108"></a><a class="code" href="structLL__HANDLE.html#m5">00108</a> <span class="preprocessor"></span>    MDIS_IDENT_FUNCT_TBL    idFuncTbl;      
00109     <span class="comment">/* debug */</span>
<a name="l00110"></a><a class="code" href="structLL__HANDLE.html#m6">00110</a>     u_int32                 dbgLevel;       
<a name="l00111"></a><a class="code" href="structLL__HANDLE.html#m7">00111</a>     DBG_HANDLE              *dbgHdl;        
00112 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00113 <span class="preprocessor"></span>    <span class="comment">/* misc */</span>
<a name="l00114"></a><a class="code" href="structLL__HANDLE.html#m8">00114</a>     OSS_SIG_HANDLE          *portChangeSig; 
<a name="l00115"></a><a class="code" href="structLL__HANDLE.html#m9">00115</a>     u_int32                 irqCount;       
<a name="l00116"></a><a class="code" href="structLL__HANDLE.html#m10">00116</a>     u_int32                 lastReq;        
00117     <span class="comment">/* IRQ latency test */</span>
<a name="l00118"></a><a class="code" href="structLL__HANDLE.html#m11">00118</a>     u_int32                 irqTest;        <span class="comment">/* test running flag (1=on) */</span>
<a name="l00119"></a><a class="code" href="structLL__HANDLE.html#m12">00119</a>     int32                   outBit;         <span class="comment">/* output bit 0..31       */</span>
<a name="l00120"></a><a class="code" href="structLL__HANDLE.html#m13">00120</a>     u_int32                 outLast;        <span class="comment">/* last set output value (1 or 0) */</span>
<a name="l00121"></a><a class="code" href="structLL__HANDLE.html#m14">00121</a>     u_int32                 irqs2fire;      <span class="comment">/* number of IRQs to fire */</span>
<a name="l00122"></a><a class="code" href="structLL__HANDLE.html#m15">00122</a>     u_int32                 startTick;      <span class="comment">/* start tick count       */</span>
<a name="l00123"></a><a class="code" href="structLL__HANDLE.html#m16">00123</a>     u_int32                 stopTick;       <span class="comment">/* stop tick count        */</span>
00124 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
00125     <span class="comment">/* toggle mode */</span>
<a name="l00126"></a><a class="code" href="structLL__HANDLE.html#m17">00126</a>     OSS_ALARM_HANDLE        *alarmHdl;      
<a name="l00127"></a><a class="code" href="structLL__HANDLE.html#m18">00127</a>     OSS_SEM_HANDLE          *devSemHdl;     
<a name="l00128"></a><a class="code" href="structLL__HANDLE.html#m19">00128</a>     u_int32                 togHigh;        
<a name="l00129"></a><a class="code" href="structLL__HANDLE.html#m20">00129</a>     u_int32                 togtimeHigh;    
<a name="l00130"></a><a class="code" href="structLL__HANDLE.html#m21">00130</a>     u_int32                 togtimeLow;     
<a name="l00131"></a><a class="code" href="structLL__HANDLE.html#m22">00131</a>     u_int32                 togBitMask;     
<a name="l00132"></a><a class="code" href="structLL__HANDLE.html#m23">00132</a>     u_int32                 togCount;       
00133     <span class="comment">/* arwen no reset */</span>
<a name="l00134"></a><a class="code" href="structLL__HANDLE.html#m24">00134</a>     u_int32                 arwenResetOff;  
00135 } <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>;
00136 
00137 <span class="comment">/* include files which need LL_HANDLE */</span>
00138 <span class="preprocessor">#include &lt;MEN/ll_entry.h&gt;</span>       <span class="comment">/* low-level driver jump table */</span>
00139 <span class="preprocessor">#include &lt;<a class="code" href="z17__drv_8h.html">MEN/z17_drv.h</a>&gt;</span>        <span class="comment">/* Z17 driver header file      */</span>
00140 
00141 <span class="comment">/*-----------------------------------------+</span>
00142 <span class="comment">|  PROTOTYPES                              |</span>
00143 <span class="comment">+-----------------------------------------*/</span>
00144 <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a14">Z17_Init</a>(DESC_SPEC *descSpec, OSS_HANDLE *osHdl,
00145                         MACCESS *ma, OSS_SEM_HANDLE *devSemHdl,
00146                         OSS_IRQ_HANDLE *irqHdl, <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> **llHdlP);
00147 <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a15">Z17_Exit</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> **llHdlP);
00148 <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a16">Z17_Read</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 ch, int32 *value);
00149 <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a17">Z17_Write</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 ch, int32 value);
00150 <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a18">Z17_SetStat</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl,int32 ch, int32 code,
00151                             INT32_OR_64 value32_or_64);
00152 <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a19">Z17_GetStat</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 ch, int32 code,
00153                             INT32_OR_64 *value32_or64P);
00154 <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a20">Z17_BlockRead</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 ch, <span class="keywordtype">void</span> *buf, int32 size,
00155                             int32 *nbrRdBytesP);
00156 <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a21">Z17_BlockWrite</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 ch, <span class="keywordtype">void</span> *buf, int32 size,
00157                                 int32 *nbrWrBytesP);
00158 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00159 <span class="preprocessor"></span>    <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a22">Z17_Irq</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl);
00160 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
00161 <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a23">Z17_Info</a>(int32 infoType, ...);
00162 <span class="keyword">static</span> <span class="keywordtype">char</span>* <a class="code" href="z17__drv_8c.html#a24">Ident</a>(<span class="keywordtype">void</span>);
00163 <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a25">Cleanup</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl, int32 retCode);
00164 <span class="keyword">static</span> <span class="keywordtype">void</span>  <a class="code" href="z17__drv_8c.html#a26">arwenReset</a>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl);
00165 
00166 <span class="keyword">static</span> <span class="keywordtype">void</span>  <a class="code" href="z17__drv_8c.html#a27">AlarmHandler</a>(<span class="keywordtype">void</span> *arg);
00167 
00168 <span class="comment">/****************************** Z17_GetEntry ********************************/</span>
00173 <span class="preprocessor">#ifdef _ONE_NAMESPACE_PER_DRIVER_</span>
00174 <span class="preprocessor"></span>    <span class="keyword">extern</span> <span class="keywordtype">void</span> LL_GetEntry(
00175         LL_ENTRY* drvP
00176     )
00177 #<span class="keywordflow">else</span>
<a name="l00178"></a><a class="code" href="z17__drv_8c.html#a28">00178</a>     <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="z17__drv_8h.html#a19">__Z17_GetEntry</a>(
00179         LL_ENTRY* drvP
00180     )
00181 #endif
00182 {
00183     drvP-&gt;init        = <a class="code" href="z17__drv_8c.html#a14">Z17_Init</a>;
00184     drvP-&gt;exit        = <a class="code" href="z17__drv_8c.html#a15">Z17_Exit</a>;
00185     drvP-&gt;read        = <a class="code" href="z17__drv_8c.html#a16">Z17_Read</a>;
00186     drvP-&gt;write       = <a class="code" href="z17__drv_8c.html#a17">Z17_Write</a>;
00187     drvP-&gt;blockRead   = <a class="code" href="z17__drv_8c.html#a20">Z17_BlockRead</a>;
00188     drvP-&gt;blockWrite  = <a class="code" href="z17__drv_8c.html#a21">Z17_BlockWrite</a>;
00189     drvP-&gt;setStat     = <a class="code" href="z17__drv_8c.html#a18">Z17_SetStat</a>;
00190     drvP-&gt;getStat     = <a class="code" href="z17__drv_8c.html#a19">Z17_GetStat</a>;
00191 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00192 <span class="preprocessor"></span>    drvP-&gt;irq         = <a class="code" href="z17__drv_8c.html#a22">Z17_Irq</a>;
00193 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
00194     drvP-&gt;info        = <a class="code" href="z17__drv_8c.html#a23">Z17_Info</a>;
00195 }
00196 
00197 <span class="comment">/******************************** Z17_Init **********************************/</span>
<a name="l00222"></a><a class="code" href="z17__drv_8c.html#a14">00222</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a14">Z17_Init</a>(
00223     DESC_SPEC       *descP,
00224     OSS_HANDLE      *osHdl,
00225     MACCESS         *ma,
00226     OSS_SEM_HANDLE  *devSemHdl,
00227     OSS_IRQ_HANDLE  *irqHdl,
00228     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>       **llHdlP
00229 )
00230 {
00231     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl = NULL;
00232     u_int32 gotsize;
00233     int32 error;
00234     u_int32 value;
00235 
00236     <span class="comment">/*------------------------------+</span>
00237 <span class="comment">    |  prepare the handle           |</span>
00238 <span class="comment">    +------------------------------*/</span>
00239     *llHdlP = NULL;     <span class="comment">/* set low-level driver handle to NULL */</span>
00240 
00241     <span class="comment">/* alloc */</span>
00242     <span class="keywordflow">if</span> ((llHdl = (<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>*)OSS_MemGet(
00243                     osHdl, <span class="keyword">sizeof</span>(<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>), &amp;gotsize)) == NULL)
00244         <span class="keywordflow">return</span> (ERR_OSS_MEM_ALLOC);
00245 
00246     <span class="comment">/* clear */</span>
00247     OSS_MemFill(osHdl, gotsize, (<span class="keywordtype">char</span>*)llHdl, 0x00);
00248 
00249     <span class="comment">/* init */</span>
00250     llHdl-&gt;memAlloc    = gotsize;
00251     llHdl-&gt;osHdl       = osHdl;
00252 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00253 <span class="preprocessor"></span>    llHdl-&gt;irqHdl      = irqHdl;
00254 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
00255     llHdl-&gt;ma          = *ma;
00256     llHdl-&gt;devSemHdl   = devSemHdl;
00257     llHdl-&gt;togtimeHigh = <a class="code" href="z17__drv_8c.html#a8">TOG_TIME_DEFAULT</a>;
00258     llHdl-&gt;togtimeLow  = <a class="code" href="z17__drv_8c.html#a8">TOG_TIME_DEFAULT</a>;
00259     llHdl-&gt;togBitMask  = 0;
00260     llHdl-&gt;togCount    = 0;
00261     llHdl-&gt;togHigh     = 0;
00262 
00263 <span class="preprocessor">#ifdef Z127_INFO_PTR</span>
00264 <span class="preprocessor"></span>    llHdl-&gt;chamu       = (CHAMELEONV2_UNIT*)ma[1];
00265 <span class="preprocessor">#endif </span>
00266 <span class="preprocessor"></span>
00267     <span class="comment">/*------------------------------+</span>
00268 <span class="comment">    |  init id function table       |</span>
00269 <span class="comment">    +------------------------------*/</span>
00270     <span class="comment">/* driver's ident function */</span>
00271     llHdl-&gt;idFuncTbl.idCall[0].identCall = <a class="code" href="z17__drv_8c.html#a24">Ident</a>;
00272     <span class="comment">/* library's ident functions */</span>
00273     llHdl-&gt;idFuncTbl.idCall[1].identCall = DESC_Ident;
00274     llHdl-&gt;idFuncTbl.idCall[2].identCall = OSS_Ident;
00275     <span class="comment">/* terminator */</span>
00276     llHdl-&gt;idFuncTbl.idCall[3].identCall = NULL;
00277 
00278     <span class="comment">/*------------------------------+</span>
00279 <span class="comment">    |  prepare debugging            |</span>
00280 <span class="comment">    +------------------------------*/</span>
00281     <a class="code" href="z17__drv_8c.html#a5">DBG_MYLEVEL</a> = OSS_DBG_DEFAULT;      <span class="comment">/* set OS specific debug level */</span>
00282     DBGINIT((NULL,&amp;<a class="code" href="z17__drv_8c.html#a6">DBH</a>));
00283 
00284     <span class="comment">/*------------------------------+</span>
00285 <span class="comment">    |  scan descriptor              |</span>
00286 <span class="comment">    +------------------------------*/</span>
00287     <span class="comment">/* prepare access */</span>
00288     <span class="keywordflow">if</span> ((error = DESC_Init(descP, osHdl, &amp;llHdl-&gt;descHdl)))
00289         <span class="keywordflow">return</span> (<a class="code" href="z17__drv_8c.html#a25">Cleanup</a>(llHdl, error));
00290 
00291     <span class="comment">/* DEBUG_LEVEL_DESC */</span>
00292     <span class="keywordflow">if</span> ((error = DESC_GetUInt32(llHdl-&gt;descHdl, OSS_DBG_DEFAULT,
00293                                 &amp;value, <span class="stringliteral">"DEBUG_LEVEL_DESC"</span>)) &amp;&amp;
00294         error != ERR_DESC_KEY_NOTFOUND)
00295         <span class="keywordflow">return</span> (<a class="code" href="z17__drv_8c.html#a25">Cleanup</a>(llHdl, error));
00296 
00297     DESC_DbgLevelSet(llHdl-&gt;descHdl, value);    <span class="comment">/* set level */</span>
00298 
00299     <span class="comment">/* DEBUG_LEVEL */</span>
00300     <span class="keywordflow">if</span> ((error = DESC_GetUInt32(llHdl-&gt;descHdl, OSS_DBG_DEFAULT,
00301                                 &amp;llHdl-&gt;dbgLevel, <span class="stringliteral">"DEBUG_LEVEL"</span>)) &amp;&amp;
00302         error != ERR_DESC_KEY_NOTFOUND)
00303         <span class="keywordflow">return</span> (<a class="code" href="z17__drv_8c.html#a25">Cleanup</a>(llHdl, error));
00304 
00305     DBGWRT_1((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z17_Init: base address = %08p\n"</span>, (<span class="keywordtype">void</span>*)llHdl-&gt;ma));
00306 
00307 <span class="preprocessor">#ifdef Z127_INFO_PTR</span>
00308 <span class="preprocessor"></span>    <span class="comment">/* print chameleon info */</span>
00309     DBGWRT_1(( <a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"   device ID:\t0x%02x \n"</span>,llHdl-&gt;chamu-&gt;devId));
00310     DBGWRT_1(( <a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"   variant:  \t0x%02x \n"</span>,llHdl-&gt;chamu-&gt;variant));
00311     DBGWRT_1(( <a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"   revision: \t0x%02x \n\n"</span>,llHdl-&gt;chamu-&gt;revision));
00312     
00313     <span class="keywordflow">if</span>( llHdl-&gt;chamu-&gt;variant &gt; 0 )
00314         llHdl-&gt;vdt = 1;
00315 <span class="preprocessor">#endif</span>
00316 <span class="preprocessor"></span>
00317     <span class="comment">/* RESET_OFF */</span>
00318     <span class="keywordflow">if</span> ((error = DESC_GetUInt32(llHdl-&gt;descHdl, <a class="code" href="z17__drv_8c.html#a12">RESET_DEFAULT</a>,
00319                                 &amp;llHdl-&gt;arwenResetOff, <span class="stringliteral">"RESET_OFF"</span>)) &amp;&amp;
00320         error != ERR_DESC_KEY_NOTFOUND)
00321         <span class="keywordflow">return</span> (<a class="code" href="z17__drv_8c.html#a25">Cleanup</a>(llHdl, error));
00322 
00323     <span class="comment">/*------------------------------+</span>
00324 <span class="comment">    |  init alarm                   |</span>
00325 <span class="comment">    +------------------------------*/</span>
00326     <span class="keywordflow">if</span> ((error = OSS_AlarmCreate(llHdl-&gt;osHdl, <a class="code" href="z17__drv_8c.html#a27">AlarmHandler</a>, llHdl,
00327                                     &amp;llHdl-&gt;alarmHdl)))
00328         <span class="keywordflow">return</span> (<a class="code" href="z17__drv_8c.html#a25">Cleanup</a>(llHdl, error));
00329 
00330     <span class="comment">/*------------------------------+</span>
00331 <span class="comment">    |  init hardware                |</span>
00332 <span class="comment">    +------------------------------*/</span>
00333     <a class="code" href="z17__drv_8c.html#a26">arwenReset</a>(llHdl);
00334     *llHdlP = llHdl;        <span class="comment">/* set low-level driver handle */</span>
00335 
00336     <span class="keywordflow">return</span> (ERR_SUCCESS);
00337 }
00338 
00339 <span class="comment">/****************************** Z17_Exit ************************************/</span>
<a name="l00349"></a><a class="code" href="z17__drv_8c.html#a15">00349</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a15">Z17_Exit</a>(
00350     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> **llHdlP
00351 )
00352 {
00353     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl = *llHdlP;
00354     int32 error = 0;
00355 
00356     DBGWRT_1((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z17_Exit\n"</span>));
00357 
00358     <span class="comment">/*------------------------------+</span>
00359 <span class="comment">    |  de-init hardware             |</span>
00360 <span class="comment">    +------------------------------*/</span>
00361     <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m24">arwenResetOff</a> == 0)
00362         <a class="code" href="z17__drv_8c.html#a26">arwenReset</a>(llHdl);
00363     <span class="comment">/*------------------------------+</span>
00364 <span class="comment">    |  clean up memory              |</span>
00365 <span class="comment">    +------------------------------*/</span>
00366     *llHdlP = NULL;     <span class="comment">/* set low-level driver handle to NULL */</span>
00367     error = <a class="code" href="z17__drv_8c.html#a25">Cleanup</a>(llHdl, error);
00368 
00369     <span class="keywordflow">return</span> (error);
00370 }
00371 
00372 <span class="comment">/****************************** Z17_Read ************************************/</span>
<a name="l00383"></a><a class="code" href="z17__drv_8c.html#a16">00383</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a16">Z17_Read</a>(
00384     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>  *llHdl,
00385     int32      ch,
00386     int32      *valueP
00387 )
00388 {
00389     DBGWRT_1((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z17_Read: ch=%d\n"</span>, ch));
00390 
00391     *valueP = MREAD_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_02_PSR);
00392 
00393     <span class="keywordflow">return</span> (ERR_SUCCESS);
00394 }
00395 
00396 <span class="comment">/****************************** Z17_Write ***********************************/</span>
<a name="l00407"></a><a class="code" href="z17__drv_8c.html#a17">00407</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a17">Z17_Write</a>(
00408     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>  *llHdl,
00409     int32      ch,
00410     int32      value
00411 )
00412 {
00413     DBGWRT_1((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z17_Write: ch=%d  val=0x%x\n"</span>, ch, value));
00414 
00415     MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_GPIO, value);
00416 
00417     <span class="keywordflow">return</span> (ERR_SUCCESS);
00418 }
00419 
00420 <span class="comment">/****************************** Z17_SetStat *********************************/</span>
<a name="l00434"></a><a class="code" href="z17__drv_8c.html#a18">00434</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a18">Z17_SetStat</a>(
00435     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>   *llHdl,
00436     int32       code,
00437     int32       ch,
00438     INT32_OR_64 value32_or_64
00439 )
00440 {
00441     int32 value = (int32)value32_or_64;     <span class="comment">/* 32bit value */</span>
00442 <span class="preprocessor">#if defined(Z127_INFO_PTR) || !defined(Z127_NOIRQ)</span>
00443 <span class="preprocessor"></span>    <a class="code" href="z17__drv_8h.html#a20">INT32_OR_64</a> valueP = value32_or_64;     <span class="comment">/* stores 32/64bit pointer */</span>
00444     <a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/structM__SG__BLOCK.html">M_SG_BLOCK</a> *blk = (<a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/structM__SG__BLOCK.html">M_SG_BLOCK</a>*)valueP;  <span class="comment">/* stores block struct pointer */</span>
00445 <span class="preprocessor">#endif</span>
00446 <span class="preprocessor"></span>
00447     MACCESS ma = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>;
00448     int32 error = ERR_SUCCESS;
00449 
00450     DBGWRT_1((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z17_SetStat: ch=%d code=0x%04x value=0x%x\n"</span>,
00451                 ch, code, value));
00452 
00453     <span class="keywordflow">switch</span> (code) {
00454         <span class="comment">/*--------------------------+</span>
00455 <span class="comment">        |  debug level              |</span>
00456 <span class="comment">        +--------------------------*/</span>
00457         <span class="keywordflow">case</span> M_LL_DEBUG_LEVEL:
00458             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m6">dbgLevel</a> = value;
00459             <span class="keywordflow">break</span>;
00460         <span class="comment">/*--------------------------+</span>
00461 <span class="comment">        |  enable interrupts        |</span>
00462 <span class="comment">        +--------------------------*/</span>
00463         <span class="keywordflow">case</span> M_MK_IRQ_ENABLE:
00464             <span class="keywordflow">break</span>;
00465         <span class="comment">/*--------------------------+</span>
00466 <span class="comment">        |  set irq counter          |</span>
00467 <span class="comment">        +--------------------------*/</span>
00468         <span class="keywordflow">case</span> M_LL_IRQ_COUNT:
00469 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00470 <span class="preprocessor"></span>            llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m9">irqCount</a> = value;
00471 <span class="preprocessor">#endif</span>
00472 <span class="preprocessor"></span>            <span class="keywordflow">break</span>;
00473         <span class="comment">/*--------------------------+</span>
00474 <span class="comment">        |  channel direction        |</span>
00475 <span class="comment">        +--------------------------*/</span>
00476         <span class="keywordflow">case</span> M_LL_CH_DIR:
00477             <span class="keywordflow">if</span> (value != M_CH_INOUT) {
00478                 error = ERR_LL_ILL_DIR;
00479             }
00480             <span class="keywordflow">break</span>;
00481         <span class="comment">/*--------------------------+</span>
00482 <span class="comment">        |  set IO ports             |</span>
00483 <span class="comment">        +--------------------------*/</span>
00484         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a0">Z17_SET_PORTS</a>:
00485             MWRITE_D32(ma, ARWEN_GPIO, MREAD_D32(ma, ARWEN_GPIO) | value);
00486             <span class="comment">/* remove bit from toggle mode */</span>
00487             <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a>) {
00488                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a> &amp;= ~value;
00489                 <span class="comment">/* stop alarm if last bit is set */</span>
00490                 <span class="keywordflow">if</span> (!llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a>)
00491                     error = OSS_AlarmClear(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m17">alarmHdl</a>);
00492             }
00493             <span class="keywordflow">break</span>;
00494         <span class="comment">/*--------------------------+</span>
00495 <span class="comment">        |  clear IO ports           |</span>
00496 <span class="comment">        +--------------------------*/</span>
00497         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a1">Z17_CLR_PORTS</a>:
00498             MWRITE_D32(ma, ARWEN_GPIO, MREAD_D32(ma, ARWEN_GPIO) &amp; ~value);
00499             <span class="comment">/* remove bit from toggle mode */</span>
00500             <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a>) {
00501                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a> &amp;= ~value;
00502                 <span class="comment">/* stop alarm if last bit is cleared */</span>
00503                 <span class="keywordflow">if</span> (!llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a>)
00504                     error = OSS_AlarmClear(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m17">alarmHdl</a>);
00505             }
00506             <span class="keywordflow">break</span>;
00507         <span class="comment">/*--------------------------+</span>
00508 <span class="comment">        |  port direction           |</span>
00509 <span class="comment">        +--------------------------*/</span>
00510         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a2">Z17_DIRECTION</a>:
00511             MWRITE_D32(ma, ARWEN_DDR, value);
00512             <span class="keywordflow">break</span>;
00513 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00514 <span class="preprocessor"></span>        <span class="comment">/*--------------------------+</span>
00515 <span class="comment">        |  edge for interrupt       |</span>
00516 <span class="comment">        +--------------------------*/</span>
00517         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a3">Z17_IRQ_SENSE</a>:
00518 <span class="preprocessor">#ifndef Z17_MODEL_Z127</span>
00519 <span class="preprocessor"></span>        <span class="comment">/* Z34/Z37 - 8 GPIOs */</span>
00520             MWRITE_D32(ma, ARWEN_02_IER1, value &amp; 0xff);
00521             MWRITE_D32(ma, ARWEN_02_IER2, (value &gt;&gt; 8) &amp; 0xff);
00522             <span class="keywordflow">break</span>;
00523 <span class="preprocessor">#else</span>
00524 <span class="preprocessor"></span>        <span class="comment">/* Z127: GPIOs 0..15 - two bits per GPIO */</span>
00525             MWRITE_D32(ma, ARWEN_02_IER1, value);
00526             <span class="keywordflow">break</span>;
00527         <span class="comment">/* Z127: GPIOs 16..31 - two bits per GPIO */</span>
00528         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a9">Z17_IRQ_SENSE_16TO31</a>:
00529             MWRITE_D32(ma, ARWEN_02_IER2, value);
00530             <span class="keywordflow">break</span>;
00531 <span class="preprocessor">#endif  </span><span class="comment">/* Z17_MODEL_Z127 */</span>
00532 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
00533         <span class="comment">/*--------------------------+</span>
00534 <span class="comment">        |  open drain               |</span>
00535 <span class="comment">        +--------------------------*/</span>
00536         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a4">Z17_OPEN_DRAIN</a>:
00537             MWRITE_D32(ma, ARWEN_02_ODER, value);
00538             <span class="keywordflow">break</span>;
00539         <span class="comment">/*--------------------------+</span>
00540 <span class="comment">        |  debouncer                |</span>
00541 <span class="comment">        +--------------------------*/</span>
00542         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a5">Z17_DEBOUNCE</a>:
00543             MWRITE_D32(ma, ARWEN_02_DBER, value);
00544             <span class="keywordflow">break</span>;
00545             
00546 <span class="preprocessor">#ifdef Z127_INFO_PTR            </span>
00547 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a15">Z17_BLK_DEBOUNCE_TIME</a>:
00548         {
00549             int8 port;
00550             <a class="code" href="structZ17__BLK__DEBTIME.html">Z17_BLK_DEBTIME</a> *dbt = (<a class="code" href="structZ17__BLK__DEBTIME.html">Z17_BLK_DEBTIME</a>*)blk-&gt;<a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/structM__SG__BLOCK.html#o1">data</a>;         
00551         
00552             <span class="comment">/* prevent access to not implemented DBCR registers */</span>      
00553             <span class="keywordflow">if</span>( llHdl-&gt;vdt == 0 ){
00554                 DBGWRT_ERR((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** LL - Z17_SetStat(Z17_BLK_DEBOUNCE_TIME): "</span>
00555                     <span class="stringliteral">" requires at least 16Z127 variant 1 IP core\n"</span>));
00556                 <span class="keywordflow">return</span> ERR_LL_ILL_FUNC;
00557             }
00558                     
00559             <span class="keywordflow">for</span>( port=0; port&lt;32; port++ ){
00560                 <span class="keywordflow">if</span>( (dbt-&gt;<a class="code" href="structZ17__BLK__DEBTIME.html#m0">portMask</a> &amp; (1&lt;&lt;port)) ){
00561                     MWRITE_D32(ma, ARWEN_Z127V01_DBCR(port), dbt-&gt;<a class="code" href="structZ17__BLK__DEBTIME.html#m1">timeUs</a>/50);
00562                 }
00563             }       
00564 
00565             <span class="keywordflow">break</span>;
00566         }
00567 <span class="preprocessor">#endif</span>
00568 <span class="preprocessor"></span>                    
00569 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00570 <span class="preprocessor"></span>        <span class="comment">/*--------------------------+</span>
00571 <span class="comment">        |  register signal          |</span>
00572 <span class="comment">        +--------------------------*/</span>
00573         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a6">Z17_SET_SIGNAL</a>:
00574             <span class="comment">/* signal already installed ? */</span>
00575             <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m8">portChangeSig</a>) {
00576                 error = ERR_OSS_SIG_SET;
00577                 <span class="keywordflow">break</span>;
00578             }
00579             error = OSS_SigCreate(<a class="code" href="z17__drv_8c.html#a7">OSH</a>, value, &amp;llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m8">portChangeSig</a>);
00580             <span class="keywordflow">break</span>;
00581         <span class="comment">/*--------------------------+</span>
00582 <span class="comment">        |  unregister signal        |</span>
00583 <span class="comment">        +--------------------------*/</span>
00584         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a7">Z17_CLR_SIGNAL</a>:
00585             <span class="comment">/* signal already installed ? */</span>
00586             <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m8">portChangeSig</a> == NULL) {
00587                 error = ERR_OSS_SIG_CLR;
00588                 <span class="keywordflow">break</span>;
00589             }
00590             error = OSS_SigRemove(<a class="code" href="z17__drv_8c.html#a7">OSH</a>, &amp;llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m8">portChangeSig</a>);
00591             <span class="keywordflow">break</span>;
00592         <span class="comment">/*--------------------------+</span>
00593 <span class="comment">        |  init IRQ latency test    |</span>
00594 <span class="comment">        +--------------------------*/</span>
00595         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a13">Z17_BLK_IRQLAT_START</a>:
00596         {
00597             int32 value;
00598             <a class="code" href="structZ17__BLK__IRQLAT.html">Z17_BLK_IRQLAT</a> *irqlat = (<a class="code" href="structZ17__BLK__IRQLAT.html">Z17_BLK_IRQLAT</a>*)blk-&gt;<a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/structM__SG__BLOCK.html#o1">data</a>;
00599 
00600             <span class="comment">/* clear out values */</span>
00601             irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m4">startTick</a> = 0;
00602             irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m5">stopTick</a> = 0;
00603             irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m6">irqsRcved</a> = 0;
00604 
00605             <span class="comment">/* init */</span>
00606             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m11">irqTest</a> = 1;
00607             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m14">irqs2fire</a> = irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m2">irqs2fire</a>-1;
00608             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m9">irqCount</a> = 0;
00609             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m16">stopTick</a> = 0;
00610 
00611             <span class="comment">/* compute and save output bit */</span>
00612             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m12">outBit</a> = 1 &lt;&lt; irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m0">outPort</a>;
00613 
00614             <span class="comment">/* disable all interrupts */</span>
00615             MWRITE_D32(ma, ARWEN_02_IER1, 0);
00616             MWRITE_D32(ma, ARWEN_02_IER2, 0);
00617 
00618             <span class="comment">/* program all ports as inputs */</span>
00619             MWRITE_D32(ma, ARWEN_DDR, 0);
00620 
00621             <span class="comment">/* determine actual state of output port */</span>
00622             value = MREAD_D32(ma, ARWEN_02_PSR);
00623             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m13">outLast</a> = (value &amp; llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m12">outBit</a>) ? 1 : 0;
00624 
00625             <span class="comment">/* preset output port value */</span>
00626             MWRITE_D32(ma, ARWEN_GPIO, value);
00627 
00628             <span class="comment">/* enable IRQ for rising+falling edge of input port */</span>
00629 <span class="comment">/* Z34/Z37 - 8 GPIOs */</span>
00630 <span class="preprocessor">#ifndef Z17_MODEL_Z127</span>
00631 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m1">inPort</a> &lt; 4) <span class="comment">/* port 3..0 */</span>
00632                 MWRITE_D32(ma, ARWEN_02_IER1, 3 &lt;&lt; (irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m1">inPort</a> * 2));
00633             <span class="keywordflow">else</span>    <span class="comment">/* port 8..4 */</span>
00634                 MWRITE_D32(ma, ARWEN_02_IER2, 3 &lt;&lt; ((irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m1">inPort</a>-4) * 2));
00635 <span class="comment">/* Z127 - 32 GPIOs */</span>
00636 <span class="preprocessor">#else</span>
00637 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m1">inPort</a> &lt; 16)    <span class="comment">/* port 15..0 */</span>
00638                 MWRITE_D32(ma, ARWEN_02_IER1, 3 &lt;&lt; (irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m1">inPort</a> * 2));
00639             <span class="keywordflow">else</span>    <span class="comment">/* port 32..16 */</span>
00640                 MWRITE_D32(ma, ARWEN_02_IER2, 3 &lt;&lt; ((irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m1">inPort</a>-16) * 2));
00641 <span class="preprocessor">#endif  </span><span class="comment">/* Z17_MODEL_Z127 */</span>
00642             <span class="comment">/* config port as output (default is input) */</span>
00643             MWRITE_D32(ma, ARWEN_DDR, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m12">outBit</a>);
00644 
00645             <span class="comment">/* set output (this fires the first IRQ) */</span>
00646             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m13">outLast</a> = !llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m13">outLast</a>;
00647             DBGWRT_3((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"set output=0x%x, irqs2fire=%d\n"</span>,
00648                         llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m13">outLast</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m14">irqs2fire</a>));
00649             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m15">startTick</a> = OSS_TickGet(<a class="code" href="z17__drv_8c.html#a7">OSH</a>);
00650             MWRITE_D32(ma, ARWEN_GPIO, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m13">outLast</a> ? llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m12">outBit</a> : 0);
00651             <span class="keywordflow">break</span>;
00652         }
00653 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
00654         <span class="comment">/*--------------------------+</span>
00655 <span class="comment">        |  Toggle mode              |</span>
00656 <span class="comment">        +--------------------------*/</span>
00657         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a10">Z17_TOG_PORTS</a>:
00658         {
00659             u_int32 realMsec;
00660 
00661             <span class="comment">/* start timer initially */</span>
00662             <span class="keywordflow">if</span> (!llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a>) {
00663                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a> = value;
00664                 error = OSS_AlarmSet(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m17">alarmHdl</a>,
00665                                         <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>, <a class="code" href="z17__drv_8c.html#a11">TOG_CYCLIC</a>, &amp;realMsec);
00666             } <span class="keywordflow">else</span> {
00667                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a> |= value;
00668                 <span class="comment">/* reset timer */</span>
00669                 error = OSS_AlarmClear(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m17">alarmHdl</a>);
00670                 error = OSS_AlarmSet(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m17">alarmHdl</a>,
00671                                         <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>, <a class="code" href="z17__drv_8c.html#a11">TOG_CYCLIC</a>, &amp;realMsec);
00672             }
00673             <span class="keywordflow">break</span>;
00674         }
00675         <span class="comment">/*--------------------------+</span>
00676 <span class="comment">        |  Toggle mode - high       |</span>
00677 <span class="comment">        +--------------------------*/</span>
00678         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a11">Z17_TOG_HIGH</a>:
00679             <span class="comment">/* adjust time value (100ms resolution) */</span>
00680             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m20">togtimeHigh</a> = (value / <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>) * <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>;
00681             <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m20">togtimeHigh</a> &gt; <a class="code" href="z17__drv_8c.html#a10">TOG_TIME_MAX</a>)
00682                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m20">togtimeHigh</a> = <a class="code" href="z17__drv_8c.html#a10">TOG_TIME_MAX</a>;
00683             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m20">togtimeHigh</a> &lt; <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>)
00684                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m20">togtimeHigh</a> = <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>;
00685             <span class="keywordflow">break</span>;
00686         <span class="comment">/*--------------------------+</span>
00687 <span class="comment">        |  Toggle mode - low        |</span>
00688 <span class="comment">        +--------------------------*/</span>
00689         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a12">Z17_TOG_LOW</a>:
00690             <span class="comment">/* adjust time value (100ms resolution) */</span>
00691             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m21">togtimeLow</a> = (value / <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>) * <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>;
00692             <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m21">togtimeLow</a> &gt; <a class="code" href="z17__drv_8c.html#a10">TOG_TIME_MAX</a>)
00693                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m21">togtimeLow</a> = <a class="code" href="z17__drv_8c.html#a10">TOG_TIME_MAX</a>;
00694             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m21">togtimeLow</a> &lt; <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>)
00695                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m21">togtimeLow</a> = <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>;
00696             <span class="keywordflow">break</span>;
00697         <span class="comment">/*--------------------------+</span>
00698 <span class="comment">        |  (unknown)                |</span>
00699 <span class="comment">        +--------------------------*/</span>
00700         <span class="keywordflow">default</span>:
00701             error = ERR_LL_UNK_CODE;
00702     }
00703 
00704     <span class="keywordflow">return</span> (error);
00705 }
00706 
00707 <span class="comment">/****************************** Z17_GetStat *********************************/</span>
<a name="l00724"></a><a class="code" href="z17__drv_8c.html#a19">00724</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a19">Z17_GetStat</a>(
00725     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>   *llHdl,
00726     int32       code,
00727     int32       ch,
00728     INT32_OR_64 *value32_or_64P
00729 )
00730 {
00731     int32 *valueP = (int32*)value32_or_64P;     <span class="comment">/* pointer to 32bit value */</span>
00732     <a class="code" href="z17__drv_8h.html#a20">INT32_OR_64</a> *value64P = value32_or_64P;     <span class="comment">/* stores 32/64bit pointer */</span>
00733     MACCESS ma = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>;
00734     int32 error = ERR_SUCCESS;
00735 <span class="preprocessor">#if defined(Z127_INFO_PTR) || !defined(Z127_NOIRQ)</span>
00736 <span class="preprocessor"></span>    <a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/structM__SG__BLOCK.html">M_SG_BLOCK</a> *blk = (<a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/structM__SG__BLOCK.html">M_SG_BLOCK</a>*)value32_or_64P;  <span class="comment">/* stores block struct pointer; not needed here */</span>
00737 <span class="preprocessor">#endif</span>
00738 <span class="preprocessor"></span><span class="preprocessor">#ifndef Z127_NOIRQ</span>
00739 <span class="preprocessor"></span>    OSS_IRQ_STATE irqState;
00740 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
00741 
00742     DBGWRT_1((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z17_GetStat: ch=%d code=0x%04x\n"</span>, ch, code));
00743 
00744     <span class="keywordflow">switch</span> (code) {
00745         <span class="comment">/*--------------------------+</span>
00746 <span class="comment">        |  debug level              |</span>
00747 <span class="comment">        +--------------------------*/</span>
00748         <span class="keywordflow">case</span> M_LL_DEBUG_LEVEL:
00749             *valueP = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m6">dbgLevel</a>;
00750             <span class="keywordflow">break</span>;
00751         <span class="comment">/*--------------------------+</span>
00752 <span class="comment">        |  number of channels       |</span>
00753 <span class="comment">        +--------------------------*/</span>
00754         <span class="keywordflow">case</span> M_LL_CH_NUMBER:
00755             *valueP = <a class="code" href="z17__drv_8c.html#a1">CH_NUMBER</a>;
00756             <span class="keywordflow">break</span>;
00757         <span class="comment">/*--------------------------+</span>
00758 <span class="comment">        |  channel direction        |</span>
00759 <span class="comment">        +--------------------------*/</span>
00760         <span class="keywordflow">case</span> M_LL_CH_DIR:
00761             *valueP = M_CH_INOUT;
00762             <span class="keywordflow">break</span>;
00763         <span class="comment">/*--------------------------+</span>
00764 <span class="comment">        |  channel length [bits]    |</span>
00765 <span class="comment">        +--------------------------*/</span>
00766         <span class="keywordflow">case</span> M_LL_CH_LEN:
00767 <span class="preprocessor">#ifndef Z17_MODEL_Z127</span>
00768 <span class="preprocessor"></span>            <span class="comment">/* Z34 / Z37 */</span>
00769             *valueP = 8;
00770             <span class="keywordflow">break</span>;
00771 <span class="preprocessor">#else</span>
00772 <span class="preprocessor"></span>            <span class="comment">/* Z127 */</span>
00773             *valueP = 32;
00774             <span class="keywordflow">break</span>;
00775 <span class="preprocessor">#endif  </span><span class="comment">/* Z17_MODEL_Z127 */</span>
00776         <span class="comment">/*--------------------------+</span>
00777 <span class="comment">        |  channel type info        |</span>
00778 <span class="comment">        +--------------------------*/</span>
00779         <span class="keywordflow">case</span> M_LL_CH_TYP:
00780             *valueP = M_CH_BINARY;
00781             <span class="keywordflow">break</span>;
00782         <span class="comment">/*--------------------------+</span>
00783 <span class="comment">        |  irq counter              |</span>
00784 <span class="comment">        +--------------------------*/</span>
00785         <span class="keywordflow">case</span> M_LL_IRQ_COUNT:
00786 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00787 <span class="preprocessor"></span>            *valueP = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m9">irqCount</a>;
00788 <span class="preprocessor">#endif</span>
00789 <span class="preprocessor"></span>            <span class="keywordflow">break</span>;
00790         <span class="comment">/*--------------------------+</span>
00791 <span class="comment">        |  ID PROM check enabled    |</span>
00792 <span class="comment">        +--------------------------*/</span>
00793         <span class="keywordflow">case</span> M_LL_ID_CHECK:
00794             *valueP = 0;
00795             <span class="keywordflow">break</span>;
00796         <span class="comment">/*--------------------------+</span>
00797 <span class="comment">        |  ident table pointer      |</span>
00798 <span class="comment">        |  (treat as non-block!)    |</span>
00799 <span class="comment">        +--------------------------*/</span>
00800         <span class="keywordflow">case</span> M_MK_BLK_REV_ID:
00801             *value64P = (INT32_OR_64)&amp;llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m5">idFuncTbl</a>;
00802             <span class="keywordflow">break</span>;
00803         <span class="comment">/*--------------------------+</span>
00804 <span class="comment">        |  port direction           |</span>
00805 <span class="comment">        +--------------------------*/</span>
00806         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a2">Z17_DIRECTION</a>:
00807             *valueP = MREAD_D32(ma, ARWEN_DDR);
00808             <span class="keywordflow">break</span>;
00809 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00810 <span class="preprocessor"></span>        <span class="comment">/*--------------------------+</span>
00811 <span class="comment">        |  edge for interrupt       |</span>
00812 <span class="comment">        +--------------------------*/</span>
00813         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a3">Z17_IRQ_SENSE</a>:
00814 <span class="preprocessor">#ifndef Z17_MODEL_Z127</span>
00815 <span class="preprocessor"></span>            <span class="comment">/* Z34/Z37 */</span>
00816             *valueP = MREAD_D32(ma, ARWEN_02_IER1) |
00817                         MREAD_D32(ma, ARWEN_02_IER2) &lt;&lt; 8;
00818             <span class="keywordflow">break</span>;
00819 <span class="preprocessor">#else</span>
00820 <span class="preprocessor"></span>            <span class="comment">/* Z127: GPIOs 0..15 - two bits per GPIO */</span>
00821             *valueP = MREAD_D32(ma, ARWEN_02_IER1);
00822             <span class="keywordflow">break</span>;
00823         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a9">Z17_IRQ_SENSE_16TO31</a>:
00824             <span class="comment">/* Z127: GPIOs 16..31 - two bits per GPIO */</span>
00825             *valueP = MREAD_D32(ma, ARWEN_02_IER2);
00826             <span class="keywordflow">break</span>;
00827 <span class="preprocessor">#endif  </span><span class="comment">/* Z17_MODEL_Z127 */</span>
00828 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
00829         <span class="comment">/*--------------------------+</span>
00830 <span class="comment">        |  open drain               |</span>
00831 <span class="comment">        +--------------------------*/</span>
00832         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a4">Z17_OPEN_DRAIN</a>:
00833             *valueP = MREAD_D32(ma, ARWEN_02_ODER);
00834             <span class="keywordflow">break</span>;
00835         <span class="comment">/*--------------------------+</span>
00836 <span class="comment">        |  debouncer                |</span>
00837 <span class="comment">        +--------------------------*/</span>
00838         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a5">Z17_DEBOUNCE</a>:
00839             *valueP = MREAD_D32(ma, ARWEN_02_DBER);
00840             <span class="keywordflow">break</span>;
00841 
00842 <span class="preprocessor">#ifdef Z127_INFO_PTR            </span>
00843 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a15">Z17_BLK_DEBOUNCE_TIME</a>:
00844         {
00845             int8    port, first=0;
00846             u_int32 timeUs=0;
00847             <a class="code" href="structZ17__BLK__DEBTIME.html">Z17_BLK_DEBTIME</a> *dbt = (<a class="code" href="structZ17__BLK__DEBTIME.html">Z17_BLK_DEBTIME</a>*)blk-&gt;<a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/structM__SG__BLOCK.html#o1">data</a>;         
00848             
00849             <span class="comment">/* prevent access to not implemented DBCR registers */</span>      
00850             <span class="keywordflow">if</span>( llHdl-&gt;vdt == 0 ){
00851                 DBGWRT_ERR((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** LL - Z17_GetStat(Z17_BLK_DEBOUNCE_TIME): "</span>
00852                     <span class="stringliteral">" requires at least 16Z127 variant 1 IP core\n"</span>));
00853                 <span class="keywordflow">return</span> ERR_LL_ILL_FUNC;
00854             }
00855 
00856             <span class="keywordflow">if</span>( dbt-&gt;<a class="code" href="structZ17__BLK__DEBTIME.html#m0">portMask</a> == 0 ){
00857                 DBGWRT_ERR((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** LL - Z17_GetStat(Z17_BLK_DEBOUNCE_TIME): "</span>
00858                     <span class="stringliteral">"no port specified\n"</span>));
00859                 <span class="keywordflow">return</span> ERR_LL_ILL_PARAM;
00860             }
00861         
00862             <span class="keywordflow">for</span>( port=0; port&lt;32; port++ ){
00863                 <span class="keywordflow">if</span>( (dbt-&gt;<a class="code" href="structZ17__BLK__DEBTIME.html#m0">portMask</a> &amp; (1&lt;&lt;port)) ){
00864                     <span class="keywordflow">if</span>( first&gt;0 ){
00865                         DBGWRT_ERR((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"*** LL - Z17_GetStat(Z17_BLK_DEBOUNCE_TIME): "</span>
00866                             <span class="stringliteral">"more than one port specified\n"</span>));
00867                         <span class="keywordflow">return</span> ERR_LL_ILL_PARAM;
00868                     }
00869                     timeUs = 50 * MREAD_D32(ma, ARWEN_Z127V01_DBCR(port));
00870                     first++;
00871                 }
00872             }
00873             
00874             dbt-&gt;<a class="code" href="structZ17__BLK__DEBTIME.html#m1">timeUs</a> = timeUs;       
00875             <span class="keywordflow">break</span>;
00876         }
00877 <span class="preprocessor">#endif                  </span>
00878 <span class="preprocessor"></span>            
00879 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00880 <span class="preprocessor"></span>        <span class="comment">/*--------------------------+</span>
00881 <span class="comment">        |  last IRQ request         |</span>
00882 <span class="comment">        +--------------------------*/</span>
00883         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a8">Z17_IRQ_LAST_REQUEST</a>:
00884             irqState = OSS_IrqMaskR(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m2">irqHdl</a>);
00885             *valueP = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m10">lastReq</a>;
00886             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m10">lastReq</a> = 0;
00887             OSS_IrqRestore(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m2">irqHdl</a>, irqState);
00888             <span class="keywordflow">break</span>;
00889         <span class="comment">/*--------------------------+</span>
00890 <span class="comment">        |  IRQ latency test result  |</span>
00891 <span class="comment">        +--------------------------*/</span>
00892         <span class="keywordflow">case</span> <a class="code" href="z17__drv_8h.html#a14">Z17_BLK_IRQLAT_RESULT</a>:
00893         {
00894             <a class="code" href="structZ17__BLK__IRQLAT.html">Z17_BLK_IRQLAT</a> *irqlat = (<a class="code" href="structZ17__BLK__IRQLAT.html">Z17_BLK_IRQLAT</a>*)blk-&gt;<a class="codeRef" doxygen="mdis_api.tag:../../../../../LIBSRC/MDIS_API/DOC/html/" href="../../../../../LIBSRC/MDIS_API/DOC/html/structM__SG__BLOCK.html#o1">data</a>;
00895 
00896             <span class="comment">/* IRQ latency test not started? */</span>
00897             <span class="keywordflow">if</span> (!llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m11">irqTest</a>) {
00898                 error = ERR_LL_DEV_NOTRDY;
00899                 <span class="keywordflow">break</span>;
00900             }
00901             <span class="comment">/* IRQ latency test not yet finished? */</span>
00902             <span class="keywordflow">if</span> (!llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m16">stopTick</a>) {
00903                 error = ERR_LL_DEV_BUSY;
00904                 <span class="keywordflow">break</span>;
00905             }
00906             llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m11">irqTest</a> = 0;
00907 
00908             <span class="comment">/* disable all IRQs */</span>
00909             MWRITE_D32(ma, ARWEN_02_IER1, 0);
00910             MWRITE_D32(ma, ARWEN_02_IER2, 0);
00911 
00912             <span class="comment">/* reset all outputs */</span>
00913             MWRITE_D32(ma, ARWEN_GPIO, 0);
00914 
00915             <span class="comment">/* program all ports as inputs */</span>
00916             MWRITE_D32(ma, ARWEN_DDR, 0);
00917 
00918             irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m3">tickRate</a> = OSS_TickRateGet(<a class="code" href="z17__drv_8c.html#a7">OSH</a>);
00919             irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m4">startTick</a> = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m15">startTick</a>;
00920             irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m5">stopTick</a> = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m16">stopTick</a>;
00921             irqlat-&gt;<a class="code" href="structZ17__BLK__IRQLAT.html#m6">irqsRcved</a> = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m9">irqCount</a>;
00922             <span class="keywordflow">break</span>;
00923         }
00924 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
00925         <span class="comment">/*--------------------------+</span>
00926 <span class="comment">        |  (unknown)                |</span>
00927 <span class="comment">        +--------------------------*/</span>
00928         <span class="keywordflow">default</span>:
00929             error = ERR_LL_UNK_CODE;
00930     }
00931 
00932     <span class="keywordflow">return</span> (error);
00933 }
00934 
00935 <span class="comment">/******************************* Z17_BlockRead ******************************/</span>
<a name="l00946"></a><a class="code" href="z17__drv_8c.html#a20">00946</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a20">Z17_BlockRead</a>(
00947     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl,
00948     int32     ch,
00949     <span class="keywordtype">void</span>      *buf,
00950     int32     size,
00951     int32     *nbrRdBytesP
00952 )
00953 {
00954     DBGWRT_1((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z17_BlockRead: ch=%d, size=%d\n"</span>, ch, size));
00955 
00956     <span class="comment">/* return number of read bytes */</span>
00957     *nbrRdBytesP = 0;
00958 
00959     <span class="keywordflow">return</span> (ERR_LL_ILL_FUNC);
00960 }
00961 
00962 <span class="comment">/****************************** Z17_BlockWrite *****************************/</span>
<a name="l00973"></a><a class="code" href="z17__drv_8c.html#a21">00973</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a21">Z17_BlockWrite</a>(
00974     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl,
00975     int32     ch,
00976     <span class="keywordtype">void</span>      *buf,
00977     int32     size,
00978     int32     *nbrWrBytesP
00979 )
00980 {
00981     DBGWRT_1((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"LL - Z17_BlockWrite: ch=%d, size=%d\n"</span>, ch, size));
00982 
00983     <span class="comment">/* return number of written bytes */</span>
00984     *nbrWrBytesP = 0;
00985 
00986     <span class="keywordflow">return</span> (ERR_LL_ILL_FUNC);
00987 }
00988 
00989 <span class="preprocessor">#ifndef Z127_NOIRQ</span>
00990 <span class="preprocessor"></span><span class="comment">/****************************** Z17_Irq ************************************/</span>
<a name="l01009"></a><a class="code" href="z17__drv_8c.html#a22">01009</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a22">Z17_Irq</a>(
01010     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl
01011 )
01012 {
01013     u_int32 irqReq;
01014     u_int32 ier1, ier2;
01015 
01016     <span class="comment">/* interrupt caused by Arwen ? */</span>
01017     irqReq = MREAD_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_IRR);
01018 
01019     IDBGWRT_1((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"&gt;&gt;&gt; LL - Z17_Irq: request %08x\n"</span>, irqReq));
01020     
01021     <span class="keywordflow">if</span> (irqReq) {
01022 
01023         <span class="comment">/* save IERs */</span>
01024         ier1 = MREAD_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_02_IER1);
01025         ier2 = MREAD_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_02_IER2);
01026         <span class="comment">/* disable all IRQs (for MSI(x)) */</span>
01027         MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_02_IER1, 0);
01028         MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_02_IER2, 0);
01029 
01030         <span class="comment">/* clear interrupt */</span>
01031         MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_IRR, irqReq);
01032         
01033         <span class="comment">/* if requested send signal to application */</span>
01034         <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m8">portChangeSig</a>)
01035             OSS_SigSend(<a class="code" href="z17__drv_8c.html#a7">OSH</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m8">portChangeSig</a>);
01036         
01037         llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m9">irqCount</a>++;
01038         llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m10">lastReq</a> = irqReq;
01039         
01040         <span class="comment">/* IRQ latency test */</span>
01041         <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m11">irqTest</a>) {
01042             <span class="comment">/* pending IRQs to fire? */</span>
01043             IDBGWRT_3((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"&gt;&gt;&gt; Z17_Irq: irqs2fire=%d\n"</span>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m14">irqs2fire</a>));
01044             <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m14">irqs2fire</a>) {
01045                 <span class="comment">/* set output (this fires the next IRQ) */</span>
01046                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m13">outLast</a> = !llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m13">outLast</a>;
01047                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m14">irqs2fire</a>--;
01048                 IDBGWRT_3((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"&gt;&gt;&gt; Z17_Irq: set output 0x%x\n"</span>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m13">outLast</a>));
01049                 MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_GPIO, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m13">outLast</a> ? llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m12">outBit</a> : 0);
01050             } <span class="keywordflow">else</span> {
01051                 <span class="comment">/* this was the last IRQ */</span>
01052                 llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m16">stopTick</a> = OSS_TickGet(<a class="code" href="z17__drv_8c.html#a7">OSH</a>);
01053             }
01054         }<span class="comment">/* IRQ latency test */</span>
01055         
01056         <span class="comment">/* enable all IRQs (for MSI(x)) */</span>
01057         MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_02_IER1, ier1);
01058         MWRITE_D32(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>, ARWEN_02_IER2, ier2);
01059 
01060         <span class="keywordflow">return</span> (LL_IRQ_DEVICE);
01061     }
01062 
01063     <span class="keywordflow">return</span> (LL_IRQ_DEV_NOT);
01064 }
01065 <span class="preprocessor">#endif  </span><span class="comment">/* Z127_NOIRQ */</span>
01066 
01067 <span class="comment">/****************************** Z17_Info ***********************************/</span>
<a name="l01105"></a><a class="code" href="z17__drv_8c.html#a23">01105</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a23">Z17_Info</a>(
01106     int32 infoType,
01107     ...
01108 )
01109 {
01110     int32   error = ERR_SUCCESS;
01111     va_list argptr;
01112 
01113     va_start(argptr, infoType);
01114 
01115     <span class="keywordflow">switch</span> (infoType) {
01116         <span class="comment">/*-------------------------------+</span>
01117 <span class="comment">        |  hardware characteristics      |</span>
01118 <span class="comment">        |  (all addr/data modes ORed)    |</span>
01119 <span class="comment">        +-------------------------------*/</span>
01120         <span class="keywordflow">case</span> LL_INFO_HW_CHARACTER:
01121         {
01122             u_int32 *addrModeP = va_arg(argptr, u_int32*);
01123             u_int32 *dataModeP = va_arg(argptr, u_int32*);
01124         
01125             *addrModeP = MDIS_MA08;
01126             *dataModeP = MDIS_MD08 | MDIS_MD16;
01127             <span class="keywordflow">break</span>;
01128         }
01129         <span class="comment">/*-------------------------------+</span>
01130 <span class="comment">        |  nr of required address spaces |</span>
01131 <span class="comment">        |  (total spaces used)           |</span>
01132 <span class="comment">        +-------------------------------*/</span>
01133         <span class="keywordflow">case</span> LL_INFO_ADDRSPACE_COUNT:
01134         {
01135             u_int32 *nbrOfAddrSpaceP = va_arg(argptr, u_int32*);
01136         
01137             *nbrOfAddrSpaceP = <a class="code" href="z17__drv_8c.html#a3">ADDRSPACE_COUNT</a>;
01138             <span class="keywordflow">break</span>;
01139         }
01140         <span class="comment">/*-------------------------------+</span>
01141 <span class="comment">        |  address space type            |</span>
01142 <span class="comment">        |  (widest used data mode)       |</span>
01143 <span class="comment">        +-------------------------------*/</span>
01144         <span class="keywordflow">case</span> LL_INFO_ADDRSPACE:
01145         {
01146             u_int32 addrSpaceIndex = va_arg(argptr, u_int32);
01147             u_int32 *addrModeP = va_arg(argptr, u_int32*);
01148             u_int32 *dataModeP = va_arg(argptr, u_int32*);
01149             u_int32 *addrSizeP = va_arg(argptr, u_int32*);
01150         
01151             <span class="keywordflow">switch</span>( addrSpaceIndex ){
01152                 <span class="keywordflow">case</span> 0:
01153                     *addrModeP = MDIS_MA08;
01154                     *dataModeP = MDIS_MD16;
01155                     *addrSizeP = <a class="code" href="z17__drv_8c.html#a4">ADDRSPACE_SIZE</a>;
01156                     <span class="keywordflow">break</span>;
01157 <span class="preprocessor">#ifdef Z127_INFO_PTR</span>
01158 <span class="preprocessor"></span>                <span class="keywordflow">case</span> 1:
01159                     *addrModeP = MDIS_MA_BB_INFO_PTR;
01160                     *dataModeP = MDIS_MD_CHAM_0;
01161                     *addrSizeP = <span class="keyword">sizeof</span>(CHAMELEONV2_UNIT);
01162                     <span class="keywordflow">break</span>;
01163 <span class="preprocessor">#endif</span>
01164 <span class="preprocessor"></span>
01165                 <span class="keywordflow">default</span>:
01166                     error = ERR_LL_ILL_PARAM;
01167             }
01168             <span class="keywordflow">break</span>;
01169         }
01170         <span class="comment">/*-------------------------------+</span>
01171 <span class="comment">        |  interrupt required            |</span>
01172 <span class="comment">        +-------------------------------*/</span>
01173         <span class="keywordflow">case</span> LL_INFO_IRQ:
01174         {
01175             u_int32 *useIrqP = va_arg(argptr, u_int32*);
01176 
01177             *useIrqP = <a class="code" href="z17__drv_8c.html#a2">USE_IRQ</a>;
01178             <span class="keywordflow">break</span>;
01179         }
01180         <span class="comment">/*-------------------------------+</span>
01181 <span class="comment">        |  process lock mode             |</span>
01182 <span class="comment">        +-------------------------------*/</span>
01183         <span class="keywordflow">case</span> LL_INFO_LOCKMODE:
01184         {
01185             u_int32 *lockModeP = va_arg(argptr, u_int32*);
01186 
01187             *lockModeP = LL_LOCK_CALL;
01188             <span class="keywordflow">break</span>;
01189         }
01190         <span class="comment">/*-------------------------------+</span>
01191 <span class="comment">        |  (unknown)                     |</span>
01192 <span class="comment">        +-------------------------------*/</span>
01193         <span class="keywordflow">default</span>:
01194             error = ERR_LL_ILL_PARAM;
01195     }
01196 
01197     va_end(argptr);
01198 
01199     <span class="keywordflow">return</span> (error);
01200 }
01201 
01202 <span class="comment">/******************************** Ident ************************************/</span>
<a name="l01207"></a><a class="code" href="z17__drv_8c.html#a24">01207</a> <span class="keyword">static</span> <span class="keywordtype">char</span>* <a class="code" href="z17__drv_8c.html#a24">Ident</a>(<span class="keywordtype">void</span>)
01208 {
01209     <span class="keywordflow">return</span> (<span class="stringliteral">"Z17 - Z17 low level driver: $Id: z17_drv.c,v 1.15 2017/05/03 16:52:05 DPfeuffer Exp $"</span>
01210 <span class="preprocessor">            #ifdef Z17_MODEL_Z127</span>
01211 <span class="preprocessor"></span>                <span class="stringliteral">" Z127 model"</span>
01212 <span class="preprocessor">            #else</span>
01213 <span class="preprocessor"></span>                <span class="stringliteral">" Z34/Z37 model"</span>
01214 <span class="preprocessor">            #endif</span>
01215 <span class="preprocessor"></span><span class="preprocessor">            #ifdef Z127_NOIRQ</span>
01216 <span class="preprocessor"></span>                <span class="stringliteral">" - no IRQs"</span>
01217 <span class="preprocessor">            #endif</span>
01218 <span class="preprocessor"></span>            );
01219 }
01220 
01221 <span class="comment">/********************************* Cleanup *********************************/</span>
<a name="l01231"></a><a class="code" href="z17__drv_8c.html#a25">01231</a> <span class="keyword">static</span> int32 <a class="code" href="z17__drv_8c.html#a25">Cleanup</a>(
01232     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl,
01233     int32     retCode
01234 )
01235 {
01236     <span class="comment">/*------------------------------+</span>
01237 <span class="comment">    |  close handles                |</span>
01238 <span class="comment">    +------------------------------*/</span>
01239     <span class="comment">/* clean up desc */</span>
01240     <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m3">descHdl</a>)
01241         DESC_Exit(&amp;llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m3">descHdl</a>);
01242 
01243     <span class="comment">/* clean up alarm */</span>
01244     <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m17">alarmHdl</a>)
01245         OSS_AlarmRemove(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, &amp;llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m17">alarmHdl</a>);
01246 
01247     <span class="comment">/* clean up debug */</span>
01248     DBGEXIT((&amp;<a class="code" href="z17__drv_8c.html#a6">DBH</a>));
01249 
01250     <span class="comment">/*------------------------------+</span>
01251 <span class="comment">    |  free memory                  |</span>
01252 <span class="comment">    +------------------------------*/</span>
01253     <span class="comment">/* free my handle */</span>
01254     OSS_MemFree(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, (int8*)llHdl, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m0">memAlloc</a>);
01255 
01256     <span class="comment">/*return error code */</span>
01257     <span class="keywordflow">return</span> (retCode);
01258 }
01259 
01260 <span class="comment">/******************************* arwenReset ********************************/</span>
<a name="l01270"></a><a class="code" href="z17__drv_8c.html#a26">01270</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="z17__drv_8c.html#a26">arwenReset</a>(
01271     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl
01272 )
01273 {
01274     MACCESS ma = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>;
01275 
01276     <span class="comment">/* disable all interrupts */</span>
01277     MWRITE_D32(ma, ARWEN_02_IER1, 0);
01278     MWRITE_D32(ma, ARWEN_02_IER2, 0);
01279 
01280     <span class="comment">/* program all ports as inputs */</span>
01281     MWRITE_D32(ma, ARWEN_DDR, 0);
01282 
01283     <span class="comment">/* disable open drain and debouncer */</span>
01284     MWRITE_D32(ma, ARWEN_02_ODER, 0);
01285     MWRITE_D32(ma, ARWEN_02_DBER, 0);
01286 }
01287 
01288 <span class="comment">/******************************* AlarmHandler ******************************/</span>
<a name="l01295"></a><a class="code" href="z17__drv_8c.html#a27">01295</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="z17__drv_8c.html#a27">AlarmHandler</a>(
01296     <span class="keywordtype">void</span> *arg
01297 )
01298 {
01299     <a class="code" href="structLL__HANDLE.html">LL_HANDLE</a> *llHdl = (<a class="code" href="structLL__HANDLE.html">LL_HANDLE</a>*)arg;
01300     MACCESS ma = llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m4">ma</a>;
01301 
01302     DBGWRT_3((<a class="code" href="z17__drv_8c.html#a6">DBH</a>, <span class="stringliteral">"&gt;&gt;&gt; LL - Z17_Z127 AlarmHandler:\n"</span>));
01303 
01304     llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m23">togCount</a> += <a class="code" href="z17__drv_8c.html#a9">TOG_TIME_MIN</a>;
01305 
01306     <span class="comment">/* reset counter */</span>
01307     <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m23">togCount</a> &gt; ((llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m20">togtimeHigh</a> + llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m21">togtimeLow</a>)))
01308         llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m23">togCount</a> = 0;
01309 
01310     <span class="comment">/* toggle high */</span>
01311     <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m19">togHigh</a> &amp;&amp; (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m23">togCount</a> &lt;= (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m20">togtimeHigh</a>))) {
01312 
01313         <span class="comment">/* lock device */</span>
01314         <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m18">devSemHdl</a>)
01315             OSS_SemWait(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m18">devSemHdl</a>, OSS_SEM_WAITFOREVER);
01316 
01317         MWRITE_D32(ma, ARWEN_GPIO, MREAD_D32(ma, ARWEN_GPIO)
01318                                     | llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a>);
01319 
01320         <span class="comment">/* release device (for other processes) */</span>
01321         <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m18">devSemHdl</a>)
01322             OSS_SemSignal(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m18">devSemHdl</a>);
01323 
01324         <span class="comment">/* reset flag */</span>
01325         llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m19">togHigh</a> = 0;
01326     }
01327 
01328     <span class="comment">/* toggle low */</span>
01329     <span class="keywordflow">if</span> ((!llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m19">togHigh</a>) &amp;&amp; (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m23">togCount</a> &gt; (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m20">togtimeHigh</a>))) {
01330 
01331         <span class="comment">/* lock device */</span>
01332         <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m18">devSemHdl</a>)
01333             OSS_SemWait(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m18">devSemHdl</a>, OSS_SEM_WAITFOREVER);
01334 
01335         MWRITE_D32(ma, ARWEN_GPIO, MREAD_D32(ma, ARWEN_GPIO)
01336                                     &amp; ~(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m22">togBitMask</a>));
01337 
01338         <span class="comment">/* release device (for other processes) */</span>
01339         <span class="keywordflow">if</span> (llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m18">devSemHdl</a>)
01340             OSS_SemSignal(llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m1">osHdl</a>, llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m18">devSemHdl</a>);
01341 
01342         <span class="comment">/* reset flag */</span>
01343         llHdl-&gt;<a class="code" href="structLL__HANDLE.html#m19">togHigh</a> = 1;
01344     }
01345 }
01346  
01347  
01348  
01349  
01350  
</pre></div>
	</div>
</div>

<div class="footer">
<!-- Footer -->
	<p class="footer">
	Generated for Z17 MDIS Driver using <a href="http://www.doxygen.org">doxygen</a>.<br>
	Copyright &copy; 2019 <a href="http://www.men.de">MEN Mikro Elektronik GmbH</a>. All Rights Reserved.
	</p>
</div>

</body>
</html>

